{% extends "base.html" %}

{% block title %}Log Habit - AI Habit Coach{% endblock %}

{% block content %}
<div class="header">
    <h1>📝 Log Habit</h1>
    <p>{{ profile.habit_description }}</p>
</div>

<div class="card">
    <h3>📊 Your Health Today</h3>
    
    {% if health.data_source == 'apple_health' %}
    <div class="alert alert-info">
        ✅ Data from Apple Health
    </div>
    {% else %}
    <div class="alert alert-info">
        🔮 Simulated health data (Apple Health not connected)
    </div>
    {% endif %}
    
    <div class="health-indicator">
        <span class="health-label">💤 Sleep Quality</span>
        <span class="health-value">{{ "%.1f"|format(health.sleep_quality) }}/10</span>
    </div>
</div>

<form method="POST" action="/log" id="habit-form">
    <input type="hidden" name="completed" id="completed-input" value="">
    
    <div class="card">
        <h3>Did you complete your habit today?</h3>
        
        <button type="button" class="btn btn-success" id="yes-btn">
            ✅ Yes, I did it!
        </button>
        
        <button type="button" class="btn btn-danger" id="no-btn">
            ❌ No, I skipped it
        </button>
    </div>
    
    <div class="card" id="details" style="display: none;">
        <h3>How was it?</h3>
        
        <div style="margin: 16px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                😅 Difficulty: <span id="difficulty-value">5</span>/10
            </label>
            <input type="range" name="difficulty" min="1" max="10" value="5" 
                   oninput="document.getElementById('difficulty-value').textContent = this.value">
        </div>
        
        <div style="margin: 16px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                💪 Motivation: <span id="motivation-value">5</span>/10
            </label>
            <input type="range" name="motivation" min="1" max="10" value="5"
                   oninput="document.getElementById('motivation-value').textContent = this.value">
        </div>
        
        <div style="margin: 16px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                ⏱️ Duration (minutes)
            </label>
            <input type="number" name="duration" value="{{ profile.habit_target_duration }}" min="0">
        </div>
        
        <div style="margin: 16px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                📔 Notes (optional)
            </label>
            <textarea name="notes" rows="3" placeholder="Any observations?"></textarea>
        </div>
        
        <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 16px;">
            💾 Save & Submit
        </button>
    </div>
</form>

<script>
// Handle "Yes" button
document.getElementById('yes-btn').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('completed-input').value = 'true';
    document.getElementById('details').style.display = 'block';
    // Scroll to details
    document.getElementById('details').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
});

// Handle "No" button
document.getElementById('no-btn').addEventListener('click', function(e) {
    e.preventDefault();
    if (confirm('Mark as skipped today?')) {
        document.getElementById('completed-input').value = 'false';
        document.getElementById('habit-form').submit();
    }
});
</script>
{% endblock %}

