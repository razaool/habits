{% extends "base.html" %}

{% block title %}AI Recommendations - AI Habit Coach{% endblock %}

{% block content %}
<div class="header">
    <h1>ğŸ¤– AI Recommendations</h1>
    <p>Personalized Insights</p>
</div>

{% if not has_models %}
<div class="card">
    <div style="text-align: center; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 10px;">âš ï¸</div>
        <h3 style="color: #ff3b30;">Models Not Trained Yet</h3>
        <p style="color: #8e8e93; margin: 15px 0;">
            Train the ML models to get AI recommendations.
        </p>
        <p style="color: #8e8e93;">
            Run: <code style="background: #2c2c2e; padding: 4px 8px; border: none; border-radius: 6px; font-size: 14px;">python3 main.py train {{ profile.name.lower().replace(' ', '_') }}</code>
        </p>
    </div>
</div>
{% else %}

<div class="card">
    <h3>ğŸ¯ Right Now</h3>
    
    <div style="text-align: center; padding: 20px;">
        <div style="font-size: 64px; font-weight: bold; color: #007aff; margin-bottom: 10px;">
            {{ (current_prob * 100)|int }}%
        </div>
        <p style="font-size: 17px; color: #8e8e93;">Predicted Success Probability</p>
    </div>
    
    {% if current_prob > 0.7 %}
    <div class="alert alert-success">
        ğŸ’š Great time to do your habit!
    </div>
    {% elif current_prob > 0.5 %}
    <div class="alert alert-info">
        ğŸ’› Decent time, you can do this!
    </div>
    {% else %}
    <div class="alert alert-info">
        ğŸ§¡ Challenging time - maybe wait for optimal window?
    </div>
    {% endif %}
    
    <!-- Today's Biometrics -->
    <div style="margin-top: 16px; padding: 14px; background: #2c2c2e; border-radius: 10px;">
        <div style="font-size: 13px; color: #8e8e93; margin-bottom: 12px;">Based on today's data:</div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 15px;">
            <div style="text-align: center;">
                <div style="color: #8e8e93; font-size: 13px;">ğŸ˜´ Sleep</div>
                <div style="color: #ffffff; font-weight: 600;">{{ "%.1f"|format(today_health.sleep_quality) }}/10</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #8e8e93; font-size: 13px;">âš¡ Energy</div>
                <div style="color: #ffffff; font-weight: 600;">{{ "%.1f"|format(today_health.energy_level) }}/10</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #8e8e93; font-size: 13px;">ğŸ˜° Stress</div>
                <div style="color: #ffffff; font-weight: 600;">{{ "%.1f"|format(today_health.stress_level) }}/10</div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; cursor: pointer;" onclick="toggleOptimalTimes()">
        <h3 style="margin: 0;">â° Best Times Today</h3>
        <span id="times-toggle" style="font-size: 24px; color: #007aff;">â€º</span>
    </div>
    <p style="color: #8e8e93; margin-bottom: 16px;">Tap to view all optimal times</p>
    
    <div id="optimal-times-list" style="display: none;">
        {% for hour, prob in optimal_times %}
        <div class="health-indicator">
            <span class="health-label">
                {{ "%02d"|format(hour) }}:00
                {% if loop.index <= 3 %}
                <span style="color: #34c759; margin-left: 4px;">â­</span>
                {% endif %}
            </span>
            <span class="health-value" style="{% if prob > 0.8 %}color: #34c759;{% elif prob > 0.7 %}color: #007aff;{% elif prob > 0.6 %}color: #ff9500;{% else %}color: #8e8e93;{% endif %}">
                {{ (prob * 100)|int }}%
            </span>
        </div>
        {% endfor %}
        
        <div style="margin-top: 16px; padding: 12px; background: #2c2c2e; border-radius: 8px; font-size: 13px; color: #8e8e93;">
            <div style="margin-bottom: 4px;">â­ = Top 3 optimal times</div>
            <div style="color: #34c759; display: inline;">â—</div> >80% 
            <div style="color: #007aff; display: inline; margin-left: 8px;">â—</div> 70-80% 
            <div style="color: #ff9500; display: inline; margin-left: 8px;">â—</div> 60-70%
        </div>
    </div>
</div>

<script>
function toggleOptimalTimes() {
    const list = document.getElementById('optimal-times-list');
    const toggle = document.getElementById('times-toggle');
    
    if (list.style.display === 'none') {
        list.style.display = 'block';
        toggle.style.transform = 'rotate(90deg)';
        toggle.textContent = 'âŒ„';
    } else {
        list.style.display = 'none';
        toggle.style.transform = 'rotate(0deg)';
        toggle.textContent = 'â€º';
    }
}
</script>

<div class="card">
    <h3>ğŸ’¡ Insights</h3>
    
    {% if stats.days_since_last > 2 %}
    <div class="alert alert-warning">
        <strong>âš ï¸ Warning:</strong> {{ stats.days_since_last }} days since last completion.<br>
        Getting back on track is crucial!
    </div>
    {% endif %}
    
    {% if stats.current_streak >= 7 %}
    <div class="alert alert-success">
        <strong>ğŸ”¥ Amazing!</strong> You're on a {{ stats.current_streak }}-day streak!<br>
        Keep the momentum going!
    </div>
    {% endif %}
    
    {% if stats.current_streak >= 21 %}
    <div class="alert alert-info">
        <strong>ğŸ† Milestone!</strong> 21+ days streak!<br>
        This habit is becoming automatic!
    </div>
    {% endif %}
</div>

    
    <!-- Model Status -->
    {% if model_timestamp %}
    <div style="text-align: center; padding: 16px; color: #8e8e93; font-size: 13px;">
        ğŸ¤– Model last trained: {{ model_timestamp.strftime('%b %d at %I:%M %p') }}
        {% if model_age_hours < 1 %}
        <span style="color: #34c759;">â— Fresh</span>
        {% elif model_age_hours < 6 %}
        <span style="color: #007aff;">â— Recent</span>
        {% else %}
        <span style="color: #ff9500;">â— Will retrain soon</span>
        {% endif %}
    </div>
    {% endif %}
</div>

{% endif %}

<div style="padding: 0 16px;">
    <a href="/" class="btn btn-primary">â† Back to Dashboard</a>
</div>
{% endblock %}

