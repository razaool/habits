{% extends "base.html" %}

{% block title %}AI Recommendations - AI Habit Coach{% endblock %}

{% block content %}
<div class="header">
    <h1>ü§ñ AI Recommendations</h1>
    <p>Personalized Insights</p>
</div>

{% if not has_models %}
<div class="card">
    <div style="text-align: center; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 10px;">‚ö†Ô∏è</div>
        <h3 style="color: #ff3b30;">Models Not Trained Yet</h3>
        <p style="color: #8e8e93; margin: 15px 0;">
            Train the ML models to get AI recommendations.
        </p>
        <p style="color: #8e8e93;">
            Run: <code style="background: #2c2c2e; padding: 4px 8px; border: none; border-radius: 6px; font-size: 14px;">python3 main.py train {{ profile.name.lower().replace(' ', '_') }}</code>
        </p>
    </div>
</div>
{% else %}

<div class="card">
    <h3>üìä When You Complete Habits</h3>
    <p style="color: #8e8e93; margin-bottom: 20px;">Based on your actual completion history</p>
    
    <!-- Hour by hour chart -->
    <div style="position: relative; height: 200px; margin: 20px 0;">
        <canvas id="completionChart"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// Prepare data for chart
const hourlyData = {{ hourly_completions|tojson }};
const labels = Array.from({length: 24}, (_, i) => i);
const counts = labels.map(hour => {
    const found = hourlyData.find(item => item[0] === hour);
    return found ? found[1] : 0;
});

// Create chart
const ctx = document.getElementById('completionChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels.map(h => h.toString().padStart(2, '0') + ':00'),
        datasets: [{
            label: 'Completions',
            data: counts,
            borderColor: '#007aff',
            backgroundColor: 'rgba(0, 122, 255, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: '#007aff',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1,
                    color: '#8e8e93'
                },
                grid: {
                    color: 'rgba(58, 58, 60, 0.3)'
                }
            },
            x: {
                ticks: {
                    color: '#8e8e93',
                    maxRotation: 45,
                    minRotation: 45,
                    font: {
                        size: 10
                    }
                },
                grid: {
                    color: 'rgba(58, 58, 60, 0.3)'
                }
            }
        }
    }
});
</script>

<div class="card">
    <h3>üí° Insights</h3>
    
    {% if stats.days_since_last > 2 %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Warning:</strong> {{ stats.days_since_last }} days since last completion.<br>
        Getting back on track is crucial!
    </div>
    {% endif %}
    
    {% if stats.current_streak >= 7 %}
    <div class="alert alert-success">
        <strong>üî• Amazing!</strong> You're on a {{ stats.current_streak }}-day streak!<br>
        Keep the momentum going!
    </div>
    {% endif %}
    
    {% if stats.current_streak >= 21 %}
    <div class="alert alert-info">
        <strong>üèÜ Milestone!</strong> 21+ days streak!<br>
        This habit is becoming automatic!
    </div>
    {% endif %}
</div>

    
    <!-- Model Status -->
    {% if model_timestamp %}
    <div style="text-align: center; padding: 16px; color: #8e8e93; font-size: 13px;">
        ü§ñ Model last trained: {{ model_timestamp.strftime('%b %d at %I:%M %p') }}
        {% if model_age_hours < 1 %}
        <span style="color: #34c759;">‚óè Fresh</span>
        {% elif model_age_hours < 6 %}
        <span style="color: #007aff;">‚óè Recent</span>
        {% else %}
        <span style="color: #ff9500;">‚óè Will retrain soon</span>
        {% endif %}
    </div>
    {% endif %}
</div>

{% endif %}

<div style="padding: 0 16px;">
    <a href="/" class="btn btn-primary">‚Üê Back to Dashboard</a>
</div>
{% endblock %}

