{% extends "base.html" %}

{% block title %}Health Data - AI Habit Coach{% endblock %}

{% block content %}
<div class="header">
    <h1>🍎 Health Data</h1>
    <p>From Apple Watch</p>
</div>

{% if not is_available %}
<div class="card">
    <div style="text-align: center; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 10px;">⚠️</div>
        <h3 style="color: #a1260d;">Apple Health Not Connected</h3>
        <p style="color: #7d8590; margin: 15px 0;">
            Using simulated health data
        </p>
        <p style="color: #8e8e93; font-size: 15px;">
            See <code style="background: #2c2c2e; padding: 4px 8px; border: none; border-radius: 6px; font-size: 14px;">APPLE_HEALTH_GUIDE.md</code> for setup instructions
        </p>
    </div>
</div>
{% else %}
<div class="alert alert-success">
    ✅ Connected to Apple Health
    <div style="margin-top: 10px; font-size: 14px;">
        📊 <strong>{{ days_with_data }}</strong> days of real data available
    </div>
</div>
{% endif %}

<div class="card">
    <h3>📊 Your Real Sleep Data</h3>
    
    {% if health_data|length == 0 %}
    <div style="text-align: center; padding: 30px; color: #7d8590;">
        <div style="font-size: 48px; margin-bottom: 15px;">😴</div>
        <p>No sleep data available yet</p>
        <p style="font-size: 14px; margin-top: 10px;">Run your iOS Shortcut to import sleep data from Apple Health</p>
    </div>
    {% endif %}
    
    {% for day_data in health_data %}
    <div style="background: #1c1c1e; padding: 16px; margin: 0 16px 12px 16px; border: none; border-radius: 10px;">
        <div style="font-weight: 600; margin-bottom: 16px; color: #ffffff; font-size: 20px; letter-spacing: -0.4px;">
            {{ day_data.date.strftime('%a, %b %d') }}
            {% if day_data.date == today %}
            <span style="background: #34c759; color: #ffffff; padding: 4px 8px; font-size: 12px; margin-left: 8px; font-weight: 600; border-radius: 6px;">Today</span>
            {% endif %}
        </div>
        
        {% if day_data.sleep_hours %}
        <!-- Real Apple Health Data -->
        <div style="margin-bottom: 16px; padding: 14px; background: #2c2c2e; border: none; border-radius: 10px;">
            <div style="font-size: 13px; color: #34c759; margin-bottom: 12px; font-weight: 600;">
                ✅ {{ day_data.data_source|replace('_', ' ')|title }} Data
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 15px; color: #ffffff;">
                <div>
                    <span style="color: #8e8e93; font-size: 15px;">💤 Total Sleep</span><br>
                    <strong style="color: #ffffff; font-size: 17px; font-weight: 600;">{{ "%.1f"|format(day_data.sleep_hours) }} hrs</strong>
                </div>
                <div>
                    <span style="color: #8e8e93; font-size: 15px;">😴 Deep</span><br>
                    <strong style="color: #ffffff; font-size: 17px; font-weight: 600;">{{ day_data.deep_sleep_min }} min</strong>
                </div>
                <div>
                    <span style="color: #8e8e93; font-size: 15px;">🌙 REM</span><br>
                    <strong style="color: #ffffff; font-size: 17px; font-weight: 600;">{{ day_data.rem_sleep_min }} min</strong>
                </div>
                <div>
                    <span style="color: #8e8e93; font-size: 15px;">👁️ Awake</span><br>
                    <strong style="color: #ffffff; font-size: 17px; font-weight: 600;">{{ day_data.awake_min }} min</strong>
                </div>
            </div>
            
            {% if day_data.bedtime and day_data.wake_time %}
            <div style="margin-top: 12px; padding-top: 12px; border-top: 0.5px solid #3a3a3c; font-size: 15px; color: #8e8e93;">
                🛏️ {{ day_data.bedtime }} → ⏰ {{ day_data.wake_time }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Sleep Quality Score -->
        <div style="padding: 20px; background: #2c2c2e; border: none; border-radius: 10px; text-align: center;">
            <div style="font-size: 15px; color: #8e8e93; margin-bottom: 12px; font-weight: 400;">Overall Sleep Quality</div>
            
            <div style="font-size: 48px; font-weight: 700; color: #007aff; letter-spacing: -1px;">
                {{ "%.1f"|format(day_data.sleep_quality) }}<span style="font-size: 24px; opacity: 0.6;">/10</span>
            </div>
            
            <div style="font-size: 17px; margin-top: 12px; color: #ffffff; font-weight: 600;">
                {% if day_data.sleep_quality >= 8.5 %}
                💚 Excellent
                {% elif day_data.sleep_quality >= 7.0 %}
                💙 Good
                {% elif day_data.sleep_quality >= 5.5 %}
                💛 Fair
                {% else %}
                🧡 Needs Improvement
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div style="padding: 0 16px;">
    <a href="/" class="btn btn-primary">← Back to Dashboard</a>
</div>
{% endblock %}

