{% extends "base.html" %}

{% block title %}Health Data - AI Habit Coach{% endblock %}

{% block content %}
<div class="header">
    <h1>🍎 Health Data</h1>
    <p>From Apple Watch</p>
</div>

{% if not is_available %}
<div class="card">
    <div style="text-align: center; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 10px;">⚠️</div>
        <h3 style="color: #a1260d;">Apple Health Not Connected</h3>
        <p style="color: #858585; margin: 15px 0;">
            Using simulated health data
        </p>
        <p style="color: #858585; font-size: 14px;">
            See <code style="background: #252526; padding: 2px 6px; border: 1px solid #3e3e42; border-radius: 4px;">APPLE_HEALTH_GUIDE.md</code> for setup instructions
        </p>
    </div>
</div>
{% else %}
<div class="alert alert-success">
    ✅ Connected to Apple Health
    <div style="margin-top: 10px; font-size: 14px;">
        📊 <strong>{{ days_with_data }}</strong> days of real data available
    </div>
</div>
{% endif %}

<div class="card">
    <h3>📊 Your Real Sleep Data</h3>
    
    {% if health_data|length == 0 %}
    <div style="text-align: center; padding: 30px; color: #858585;">
        <div style="font-size: 48px; margin-bottom: 15px;">😴</div>
        <p>No sleep data available yet</p>
        <p style="font-size: 14px; margin-top: 10px;">Run your iOS Shortcut to import sleep data from Apple Health</p>
    </div>
    {% endif %}
    
    {% for day_data in health_data %}
    <div style="background: #252526; padding: 16px; margin-bottom: 12px; border: 1px solid #3e3e42; border-radius: 6px;">
        <div style="font-weight: 600; margin-bottom: 12px; color: #ffffff;">
            {{ day_data.date.strftime('%a, %b %d') }}
            {% if day_data.date == today %}
            <span style="background: #0d7377; color: #ffffff; padding: 2px 6px; font-size: 10px; margin-left: 8px; font-weight: 500; border-radius: 4px;">Today</span>
            {% endif %}
        </div>
        
        {% if day_data.sleep_hours %}
        <!-- Real Apple Health Data -->
        <div style="margin-bottom: 16px; padding: 12px; background: #1e1e1e; border: 1px solid #3e3e42; border-radius: 4px;">
            <div style="font-size: 12px; color: #0d7377; margin-bottom: 8px; font-weight: 600;">
                ✅ {{ day_data.data_source|replace('_', ' ')|title }} Data
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 14px; color: #d4d4d4;">
                <div>
                    <span style="opacity: 0.7;">💤 Total Sleep:</span>
                    <strong style="color: #0d7377;">{{ "%.1f"|format(day_data.sleep_hours) }} hrs</strong>
                </div>
                <div>
                    <span style="opacity: 0.7;">😴 Deep:</span>
                    <strong style="color: #4fc1ff;">{{ day_data.deep_sleep_min }} min</strong>
                </div>
                <div>
                    <span style="opacity: 0.7;">🌙 REM:</span>
                    <strong style="color: #4fc1ff;">{{ day_data.rem_sleep_min }} min</strong>
                </div>
                <div>
                    <span style="opacity: 0.7;">👁️ Awake:</span>
                    <strong style="color: #4fc1ff;">{{ day_data.awake_min }} min</strong>
                </div>
            </div>
            
            {% if day_data.bedtime and day_data.wake_time %}
            <div style="margin-top: 8px; font-size: 12px; color: #858585;">
                🛏️ {{ day_data.bedtime }} → ⏰ {{ day_data.wake_time }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Sleep Quality Score -->
        <div style="padding: 16px; background: #1e1e1e; border: 1px solid #3e3e42; border-radius: 4px; text-align: center;">
            <div style="font-size: 12px; color: #858585; margin-bottom: 8px;">Overall Sleep Quality</div>
            
            <div style="font-size: 32px; font-weight: 600; color: #4fc1ff;">
                {{ "%.1f"|format(day_data.sleep_quality) }}<span style="font-size: 18px; opacity: 0.7;">/10</span>
            </div>
            
            <div style="font-size: 14px; margin-top: 8px; color: #858585;">
                {% if day_data.sleep_quality >= 8.5 %}
                💚 Excellent
                {% elif day_data.sleep_quality >= 7.0 %}
                💙 Good
                {% elif day_data.sleep_quality >= 5.5 %}
                💛 Fair
                {% else %}
                🧡 Needs Improvement
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<a href="/" class="btn btn-primary">← Back to Dashboard</a>
{% endblock %}

